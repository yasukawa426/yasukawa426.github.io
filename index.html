<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SadBoy's Place</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" href="/resources/icons/frown.png" />
    <script src="/components/loader.js" type="module" defer></script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-1T5L5ZNXHP"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-1T5L5ZNXHP");
    </script>
  </head>
  <body>
    <div id="container">
      <div id="headerArea">
        <navbar-component></navbar-component>
      </div>
      <div id="flex">
        <main>
          <div id="intro">
            <h1>Welcome to my Website!</h1>

            <center>
              <p>
                <strong
                  >Please read this first, or don't idc (I actually do).</strong
                >
              </p>
            </center>
            <center>
              <p>
                <strong>
                  Hey, one more thing. Uuuh... Don't take this site too
                  seriously, ok? I just made it for fun. Don't judge me, thanks.
                  üëç
                </strong>
              </p>
            </center>
            <p>
              The purpose of this website is just to be a place where I share my
              thoughts and whatever I want. Basically, a digital and public
              diary, i guess. I just hope nobody that I know in real life read
              it.
            </p>
            <p>
              I plan to share stuff I find interesting, vent and write a dream
              journal. Hopefully, whenever I plan to add something new to it, I
              will first write what I am going to do on the
              <a href="/html/random_pages/roadmap.html">roadmap</a> page and
              after implementing it, I will write the changes on the
              <a href="/html/random_pages/changelog.html">changelog</a> page.
            </p>
          </div>

          <div id="navigation">
            <h1>Navigation</h1>
            This section will list all the main links:
            <ul>
              <li>
                <a href="html/about_me/about_me.html">About Me:</a> Stuff about
                me. Who am I? What do I dream about? What are my thoughts? Good
                questions.
              </li>
              <li>
                <a href="html/about_me/dream_journal/dream_journal.html"
                  >Dream Journal:</a
                >
                My dream journal, the place where I write all my dreams.
              </li>
              <li>
                <a href="html/about_me/hobbies/gaming/gaming.html">Gaming:</a>
                All my games collection and games I developed. Plan to add other
                stuff in the future as well.
              </li>
              <li>
                <a href="html/random_pages/changelog.html">Changelog:</a> Page
                containing all changes made.
              </li>
              <li>
                <a href="html/random_pages/roadmap.html">Roadmap:</a> Stuff I
                plan to add.
              </li>
            </ul>
          </div>

          <div id="pages">
            <h1>All Pages</h1>
            <div
              id="loader-container"
              style="
                height: 300px;
                justify-content: center;
                align-items: center;
                display: flex;
              "
            >
              <div class="loader"></div>
            </div>
            <div id="latest-changes"></div>
            <div id="pages-index"></div>
          </div>

          <div id="comments">
            <h1>Comments</h1>
            <script
              src="https://utteranc.es/client.js"
              repo="yasukawa426/yasukawa426.github.io"
              issue-term="title"
              label="Comment"
              theme="icy-dark"
              crossorigin="anonymous"
              async
            ></script>
          </div>
        </main>
      </div>
      <footer id="footer">
        <a href="mailto:sadlilboy32@outlook.com">Contact me.</a>
      </footer>
    </div>

    <script>
      //TODO: Move both these functions to their own .js file
      // Fetches the html indexing from file and then displays on the html.
      async function fetchAndFillIndexes(indexesElement) {
        // load the index from file and then add on the page
        result = await fetch("indexes.txt");

        if (result.status == 200) {
          result.text().then((body) => {
            indexesElement.innerHTML = body;
          });
        } else {
          indexesElement.innerHTML = "<p>Failed to load index, sorry...</p>";
        }
      }

      // Fetches latest 5 commits.
      // If succesful, save to session storage at "commits". ["latest commit message - files: ...", "second latest commit message", ...].
      // If failed to load commits, throws an error.
      async function fetchCommits() {
        result = await fetch(
          "https://api.github.com/repos/yasukawa426/yasukawa426.github.io/commits"
        );

        if (result.status == 200) {
          // Success!

          let commits = [];

          result.json().then(async (body) => {
            // For the latest 5 commits,
            for (let i = 0; i < 5; i++) {
              // Get its message and sha.
              const message = body[i].commit.message;
              const ref = body[i].sha;

              // fetches the specific commit to get the files edited
              const result = await fetch(
                `https://api.github.com/repos/yasukawa426/yasukawa426.github.io/commits/${ref}`
              );

              if (result.status == 200) {
                // Success! Lets grab its files now!
                const commitJson = await result.json();
                let editedFiles = "";

                for (let i = 0; i < commitJson.files.length; i++) {
                  // Split its path and add to the string
                  if (commitJson.files[i].filename.includes("/")) {
                    let fileName = commitJson.files[i].filename.split("/");
                    editedFiles = `${fileName[fileName.length - 1]}; `;
                  } else {
                    editedFiles = `${commitJson.files[i].filename}; `;
                  }
                }

                // Then we add the commit with its message and files to the commits array.
                commits.push(`${message} - Files: ${editedFiles.trim()}`);
              } else {
                throw new Error("Failed to load commits! :(");
              }

              sessionStorage.setItem("commits", commits);
            }
          });
        } else {
          throw new Error("Failed to load commits! :(");
        }
      }

      // Adds the commits into the html
      function addCommitsToHtml(commits, element) {
        let commitsHtml = "";

        for (let i = 0; i < commits.length; i++) {
          commitsHtml = `${commitsHtml} <li>${commits[i]}</li>`;
        }

        commitsHtml =
          "<p>Latest changes (loaded from <a href='https://github.com/yasukawa426/yasukawa426.github.io'>GitHub</a>):</p><ul>" +
          commitsHtml +
          "</ul>";

        element.innerHTML = commitsHtml;
      }

      fetchAndFillIndexes(document.getElementById("pages-index")).then(() => {
        // Waits for the indexes fetching to be done and then removes the loader indicator.
        indexLoaderIndicator = document.getElementById("loader-container");
        indexLoaderIndicator.remove();
      });

      let commitsDiv = document.getElementById("latest-changes");
      let commits;

      // Check if the commits are saved in the sessionStorage, if not, fetch it from github api.
      if (sessionStorage.getItem("commits")) {
        commits = sessionStorage.getItem("commits").split(",");

        addCommitsToHtml(commits, commitsDiv);
      } else {
        fetchCommits().then(() => {
          commits = sessionStorage.getItem("commits").split(",");

          addCommitsToHtml(commits, commitsDiv);
        });
      }
    </script>
  </body>
</html>
